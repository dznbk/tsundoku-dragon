# タスクリスト

## タスク完了の原則

**このファイルの全タスクが完了するまで作業を継続すること**

### 必須ルール

- 全てのタスクを `[x]` にすること
- 未完了タスク `[ ]` を残したまま作業を終了しない
- 「時間の都合」「難しい」などの理由でのスキップは禁止

### スキップが許可されるケース

技術的理由に該当する場合のみ:

- 実装方針の変更により機能自体が不要になった
- アーキテクチャ変更により別の実装方法に置き換わった

スキップ時は理由を明記:

```markdown
- [~] タスク名 (スキップ理由: 具体的な技術的理由)
```

---

## 進捗

- 開始: 2026-01-10
- 完了: 2026-01-10

---

## フェーズ1: 準備

- [x] DynamoDB Localの起動確認
- [x] テスト用テーブルの存在確認

## フェーズ2: 統合テスト実装

- [x] `bookRepository.integration.test.ts` ファイル作成
- [x] テストヘルパー（ユニークID生成、テストデータ生成）の実装
- [x] save & findById ラウンドトリップテストの実装
- [x] findByUserId クエリテスト（複数件取得）の実装
- [x] findByUserId クエリテスト（他ユーザーのデータが含まれないこと）の実装
- [x] エッジケーステスト（データなしユーザー）の実装
- [x] エッジケーステスト（存在しないID）の実装
- [x] クリーンアップロジックの実装・検証

## フェーズ3: 品質チェック

- [x] 統合テストが通ることを確認 (`npm run test:integration`)
- [x] 既存ユニットテストに影響がないことを確認 (`npm run test`)
- [x] 全テストが通ることを確認 (`npm run test:all`)
- [x] リントエラーがないことを確認 (`npm run lint`)
- [x] 型エラーがないことを確認 (`npm run typecheck`)
- [x] フォーマットエラーがないことを確認 (`npm run format:check`)

---

## 振り返り

### うまくいったこと

- 既存の `dynamodb-helper.ts` を最大限活用できた
- ユニークID戦略（タイムスタンプ+ランダム値）によりテストの独立性を確保
- デトロイト派のテスト哲学に忠実に、mockを使わず本物のDynamoDB Localを使用
- 統合テストが6件すべて成功し、実行時間も216ms以内に収まった

### 改善点

- テストデータ作成時に `status: 'defeated'` を使用しようとしたが、`BookStatus` 型には存在しなかった
- 事前に型定義を確認すべきだった

### 次回への学び

- 型定義を事前に確認する（特にリテラル型の場合）
- このパターンは他のRepository（UserRepository, SkillRepository）の統合テストにも適用可能
- テスト失敗時のデータ残留を防ぐため、`beforeEach`でのクリーンアップも検討する価値あり

### 申し送り事項

- 今回のテストは他のRepositoryの統合テストの**ゴールデンパターン**として活用可能
- `implementation-validator`の提案:
  - 更新操作（saveの上書き動作）の統合テスト追加を検討
  - `Book`型の定義を`data-design.md`と完全に一致させる必要あり（`enemyImageUrl`, `archived`ステータス）
  - テストデータファクトリを`apps/api/src/test-utils/fixtures/`に外部化すると再利用性向上
