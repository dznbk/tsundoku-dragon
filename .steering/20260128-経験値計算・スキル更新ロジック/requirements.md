# 経験値計算・スキル更新ロジック

## 概要

戦闘ログ記録時に経験値を計算し、スキルの経験値・レベルを更新する。既存の recordBattle API レスポンスを拡張して経験値情報を返す。

## 背景

- 本アプリのRPG性を実現するためには、読書（戦闘）で経験値を獲得しスキルが成長する仕組みが必要
- #55 で戦闘ログ記録APIは実装済み。次のステップとして経験値計算を追加する
- フロントエンドの討伐演出・レベルアップ表示（#59）がこの機能の結果を使用予定

## 要件

### 機能要件

- [x] 読んだページ数に応じて経験値を付与（1ページ = 1exp）
- [x] 本を討伐（読了）した場合、ページ数の10%をボーナス経験値として追加付与
- [x] 本に紐づく全スキルに同じ経験値を付与（分割しない）
- [x] 経験値に応じてレベルを計算（`floor(Lv^1.5 × 50)`）
- [x] レベル上限は9999
- [x] 戦闘ログ記録APIのレスポンスに経験値情報を追加

### 非機能要件

- 複数スキルの更新は並列処理で効率化
- 経験値計算は純粋関数として実装し、テスト容易性を確保

## 受け入れ条件

- [x] 経験値計算ユーティリティのユニットテストがパスする
- [x] recordBattle が経験値情報を含むレスポンスを返す
- [x] 複数スキルに同時に経験値が付与される
- [x] 討伐時にボーナス経験値が加算される
- [x] レベルアップが正しく検出される
- [x] 全テスト・lint・typecheck がパスする

## 対象外（スコープ外）

- フロントエンドの討伐演出・レベルアップ表示（#59で対応）
- 再読ボーナス（仕様上なし）
- クリティカルヒット等の拡張経験値システム

## 参考ドキュメント

- [planning/exp-system.md](../../../planning/exp-system.md) - 経験値システム仕様
- [planning/data-design.md](../../../planning/data-design.md) - DynamoDBスキーマ
- [Issue #56](https://github.com/dznbk/tsundoku-dragon/issues/56)
