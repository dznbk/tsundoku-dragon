# 開発コンテキスト

このファイルは開発セッション間でコンテキストを引き継ぐためのものです。

## プロジェクト概要

**積読＆ドラゴンズ** - 積読消化をRPGのように楽しくやれるWebアプリ

詳細は [planning/product-concept.md](../planning/product-concept.md) を参照。

---

## 技術スタック（決定済み）

| 項目 | 選定 | 備考 |
|------|------|------|
| フロントエンド | React + TypeScript | Vite使用 |
| ホスティング（フロント） | Cloudflare Pages | |
| API | Cloudflare Workers + Hono | TypeScript |
| DB | DynamoDB | プロビジョンドモード（無料枠内に収める） |
| 認証 | Firebase Auth | Google, Twitter認証 |
| 画像ストレージ | Cloudflare R2 | 敵画像の保存用 |

### 選定理由

**Cloudflare Pages / Workers / R2**
- 既にCloudflareでドメイン（deepon.dev）を運用しており、統一したかった
- 無料枠が大きく、ランニングコストを抑えられる

**DynamoDB**
- MySQLの経験が多いため、違うDBを学習したかった
- AWSアカウントを既に持っている
- 無料枠（ストレージ25GB、25RCU/WCU）で個人開発には十分

**Firebase Auth**
- 認証自体は無料（電話認証のみ有料）
- Google, Twitter認証の設定が簡単
- 情報が多く、トラブル時に解決しやすい

**React + TypeScript**
- 既存の経験あり（deepon.dev, app001.deepon.devで使用）

**Hono**
- Cloudflare Workers向けに最適化された軽量Webフレームワーク
- Express風のAPIで学習コストが低い
- TypeScript対応が良い
- 日本人作者で日本語情報が多い

### DynamoDB注意点
- 必ず**プロビジョンドモード**で作成（オンデマンドだと課金される）
- Auto Scalingは無効にする
- AWS Budgetsでアラート設定推奨

---

## 未決定事項・次回検討事項

### ワイヤーフレーム
- 各画面の具体的なレイアウト
- コンポーネント設計

---

## 決定済み事項サマリ

| 項目 | 決定内容 |
|------|----------|
| ターゲット | 一般書籍含む、一人利用 |
| 認証 | SNS認証（複数デバイス対応のため） |
| スキル構造 | フラット、ユーザー定義可能 |
| スキル選択 | 選択肢から選ぶ or 自由入力で新規追加 |
| スキルマスタ | グローバル + ユーザー独自の2層構造 |
| レベルアップ | あり |
| 戦闘方式 | 一方的攻撃、ドラクエ風メッセージ |
| 敵画像 | デフォルト1種、複数対応の構造で実装 |
| スキル表示 | MVP時点はリスト表示 |
| 本とスキル | 1冊に複数スキル紐づけ可能 |
| 進捗記録 | 差分ログ + 本に現在ページを保持 |
| 戦闘ログ | 履歴として残す、メモは任意 |
| 再読 | 同じエントリで進捗リセット、周回数を記録 |
| ISBN/書影 | ISBN保存、書影はopenBD/NDLサーチで取得 |
| 経験値 | 1ページ = 1exp、討伐ボーナス10% |
| 複数スキル経験値 | 各スキルに同じ経験値（分割しない） |
| レベル計算式 | `Lv^1.5 × 50`（累乗式） |
| レベル上限 | 9999 |
| 再読ボーナス | なし |

### データ設計

詳細は [planning/data-design.md](../planning/data-design.md) を参照。

### 経験値・レベルシステム

詳細は [planning/exp-system.md](../planning/exp-system.md) を参照。

### 画面設計

詳細は [planning/screen-design.md](../planning/screen-design.md) を参照。

---

## 開発の進め方（想定）

1. まず本の登録機能を作ってデプロイして動作確認
2. 順次機能を追加していく

---

## 議論ログ

### 2024-12-17 画面設計

**議論した内容：**
- 必要な画面の洗い出し
- 各画面の目的と要素の定義
- ホーム画面の構成（本一覧 + 簡易ステータス）
- 討伐済み本の表示方法

**決定事項と理由：**

| 決定 | 理由 |
|------|------|
| 6画面構成（ログイン、ホーム、登録、詳細、戦闘、スキル一覧） | MVPとして必要十分 |
| ホームに簡易ステータス表示 | 別画面だと見なくなる、でも詳細すぎると煩雑 |
| 討伐済みはトグルで表示切替 | デフォルトは戦闘中のみ、過去も見たい時に切替 |
| 戦闘は独立画面 | 演出に集中、達成感を最大化 |
| 各画面1目的 | シンプルで迷わない導線 |

---

### 2024-12-16 経験値・レベルシステム

**議論した内容：**
- 経験値獲得量（1ページ = ?exp）
- 討伐ボーナスの有無と割合
- 複数スキルへの経験値分配方法
- レベルアップ必要経験値の計算式（線形 vs 累乗）
- レベル上限
- 再読ボーナスの有無

**決定事項と理由：**

| 決定 | 理由 |
|------|------|
| 1ページ = 1exp | シンプルでわかりやすい |
| 討伐ボーナス10% | 読了のインセンティブ |
| 各スキルに同じ経験値 | 分割すると1スキルにした方が効率的になってしまう |
| 累乗式（Lv^1.5 × 50） | 線形だと単調、序盤サクサク後半じわじわ |
| レベル上限9999 | 学習に終わりはない |
| 再読ボーナスなし | シンプルさ優先 |

---

### 2024-12-14 データ設計

**議論した内容：**
- DynamoDBのPK/SK設計（シングルテーブル）
- 本とスキルの関係（1対多）
- 進捗記録の粒度（差分 vs 累計）
- 戦闘ログの保存要否
- 再読時の挙動
- スキルマスタの構造（グローバル vs ユーザー独自）
- ISBN/書影の扱い
- メモ機能と検索性

**決定事項と理由：**

| 決定 | 理由 |
|------|------|
| 本に現在ページを持つ | 一覧表示時に毎回全ログ集計は非効率 |
| 差分でログ記録 | 「今日30ページ読んだ」が自然な入力、履歴も残る |
| 戦闘ログを残す | 後から振り返りたい |
| 再読は同じエントリ | 本としては同一、周回数で管理 |
| スキル2層構造 | 一般的なスキルの表記揺れ防止 + ニッチなスキルでグローバル汚染防止 |
| ISBN保存、書影はAPI | openBD/NDLサーチで取得可能、画像アップロードはMVP不要 |
| メモは任意 | 必須だと記録が億劫になる |
| メモ検索はMVP外 | DynamoDBは全文検索に向かない、YAGNI |

---

### 2024-12-14 技術選定

**議論した内容：**
- Cloudflare Workers / Supabase の比較
- ドキュメントDB vs RDBMSの検討
- DynamoDBの無料枠と課金モデル
- 認証サービスの比較（Firebase Auth, Clerk, Auth0, Cognito）
- 画像ストレージの選定

**決定事項：**
- Cloudflare Pages + Workers + R2 でCloudflare寄せ
- DBはDynamoDB（学習目的も兼ねて）
- 認証はFirebase Auth
- DynamoDBはプロビジョンドモードで無料枠内運用

---

### 2024-12-13 初回壁打ち

**議論した内容：**
- 基本コンセプトの確認
- ターゲットユーザーの明確化
- MVP機能の範囲
- スキルシステムの設計方針
- 戦闘の体験設計
- 敵画像の扱い
- 認証の必要性

**次回やること：**
- 画面設計
